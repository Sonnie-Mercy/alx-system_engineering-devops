#!/usr/bin/env bash
# This script configures Nginx on web-02 to be identical to web-01,
# and adds a custom HTTP header to its response.

# Install Nginx on web-02 if it's not already installed
sudo apt-get update
sudo apt-get install nginx -y

# Copy the Nginx configuration files from web-01 to web-02
scp -r ubuntu@52.91.146.63:/etc/nginx/* /etc/nginx/

# Replace all instances of "web-01" with "web-02" in the configuration files
sudo sed -i 's/web-01/web-02/g' /etc/nginx/nginx.conf
sudo sed -i 's/web-01/web-02/g' /etc/nginx/sites-available/*

# Add a custom HTTP header to the Nginx response
sudo sed -i '/listen \[::\]:80 default_server/a add_header X-Served-By $hostname;' /etc/nginx/sites-available/default

# Restart Nginx to apply the changes
sudo service nginx restart

# Test that Nginx on web-02 is serving content and responding with the custom HTTP header correctly
curl -sI localhost | grep X-Served-By
